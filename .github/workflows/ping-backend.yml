name: Ping Backend Health Every 10 Minutes

on:
  schedule:
    # –æ—Ç 04:00 –¥–æ 22:59 UTC ‚Üí –ø–æ–∫—Ä–∏–≤–∞ 06:00‚Äì01:00 BG (–∑–∏–º–∞/–ª—è—Ç–æ)
    - cron: "*/10 4-22 * * *"
  workflow_dispatch:

jobs:
  ping-health:
    runs-on: ubuntu-latest
    steps:
      - name: Ping Render Backend /health
        run: |
          echo "----------------------------------------"
          echo "üì° HEALTH CHECK START: $(date)"
          echo "----------------------------------------"

          RESPONSE=$(curl -s --max-time 8 -w "\n%{http_code}" https://recipebook-backend-n3c2.onrender.com/health)
          BODY=$(echo "$RESPONSE" | head -n 1)
          STATUS=$(echo "$RESPONSE" | tail -n 1)

          echo "‚û°Ô∏è  Response body: $BODY"
          echo "‚û°Ô∏è  HTTP status: $STATUS"

          if [ -z "$BODY" ]; then
            echo "‚ùå No response body ‚Äî network or DNS issue."
            exit 1
          fi

          if [ "$STATUS" -ne 200 ]; then
            echo "‚ùå Backend is DOWN or returned non-200!"
            exit 1
          fi

          echo "‚úÖ Backend is UP and healthy!"